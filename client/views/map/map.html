<template name="map">
  <!-- javascript and css in html lol need to fix -->
  <style>
    body { margin:0px; padding:0px; }
    #map { position:absolute; top:57px; bottom:0px; width:100%; right:0px; left:0px; }
  </style>

  <div id="map"></div>

  <script>
    // todo - center map to geolocation coords
    L.mapbox.accessToken = 'pk.eyJ1IjoianVsc2FudGFuYSIsImEiOiIxRzM0SmhNIn0.0ZzDMXxGti5sXpTwai0TXA';
    var map = L.mapbox.map('map', 'julsantana.lia8ji15').setView([37.7833, -122.4167], 12)
    // primary layer we will be working with
    var markerLayer = L.mapbox.featureLayer().addTo(map);


    markerLayer.on('click', function(e) {
      var marker_id = e.target._geojson[0]._id
      map.panTo(e.layer.getLatLng());
      window.location.replace(e.layer.feature.properties.url);
    });

    markerLayer.on('mouseover', function(e) {
      e.layer.openPopup();
    });

    markerLayer.on('mouseout', function(e) {
      // e.layer.closePopup();
    });

    markerLayer.on('layeradd', function(e) {
      var marker = e.layer;
      var feature = marker.feature;
      var image = feature.photo_id;

      var popupContent = '<div class="popup">' +
                          '<h2>Pops Ups</h2>' +
                         '</div>';



      marker.bindPopup('<h2>Pops Up</h2>');
    });


    // keep for new page loads
    var geoJsonArr = []
    MarkersCollection.find({'user_id': Meteor.userId()}).forEach(function (marker) {
      geoJsonArr.push(marker);
    });
    markerLayer.setGeoJSON(geoJsonArr);
  </script>
</template>
