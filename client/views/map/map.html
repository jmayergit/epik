<template name="map">
  <!-- javascript and css in html lol need to fix -->
  <style>
    body { margin:0; padding:0; }
    #map { position:absolute; top:50px; bottom:0; width:100%; }
  </style>

  <div id="map"></div>

  <script>
    // todo - center map to geolocation coords
    L.mapbox.accessToken = 'pk.eyJ1IjoianVsc2FudGFuYSIsImEiOiIxRzM0SmhNIn0.0ZzDMXxGti5sXpTwai0TXA';
    var map = L.mapbox.map('map', 'julsantana.lia8ji15').setView([37.7833, -122.4167], 12)
    // primary layer we will be working with
    var markerLayer = L.mapbox.featureLayer().addTo(map);


    markerLayer.on('click', function(e) {
      var marker_id = e.target._geojson[0]._id
      map.panTo(e.layer.getLatLng());
      window.location.replace(e.layer.feature.properties.url);
    });
    markerLayer.on('mouseover', function(e) {
      e.layer.openPopup();
    });
    markerLayer.on('mouseout', function(e) {
      e.layer.closePopup();
    });


    // keep for new page loads
    var geoJsonArr = []
    MarkersCollection.find({'user_id': Meteor.userId()}).forEach(function (marker) {
      geoJsonArr.push(marker);
    });
    markerLayer.setGeoJSON(geoJsonArr);
  </script>
</template>
